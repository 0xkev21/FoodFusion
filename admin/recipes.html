<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Recipes | FoodFusion</title>

  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <main>
    <section class="sidebar">
      <div class="top">
        <div class="logo">
          <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
            <path
              d="M21.3,3.23a1,1,0,0,0-1.05-.22l-6.23,2.27-5-2.14a1,1,0,0,0-1,0L2,5.76V16.2a1,1,0,0,0,.5.87l6,3.85a1,1,0,0,0,1,0l6-3.85a1,1,0,0,0,.5-.87V8.52l5.28-1.92A1,1,0,0,0,22,5.58V4.28A1,1,0,0,0,21.3,3.23ZM8,17.13,4,14.58V7.58l3.92,1.68Zm2,0V9.26l4-1.45v7.92Zm8.28-12.2-4.23,1.54L10,8.15V5.58L14,4l4.23,1.54Z">
            </path>
          </svg>
        </div>
        <div>
          <h1>FoodFusion</h1>
          <p>Admin Panel</p>
        </div>
      </div>
      <div class="side-nav">
        <a href="admin_dashboard.php"><i class="bi bi-speedometer2"></i>Dashboard</a>
        <a href="admin_recipes.php" class="active"><i class="bi bi-fork-knife"></i>Recipes</a>
        <a href="create_recipe.php"><i class="bi bi-plus-circle"></i>Add Recipe</a>
        <a href="create_event.php"><i class="bi bi-calendar-event"></i>Events</a>
        <button class="logout-btn"><i class="bi bi-box-arrow-left"></i>Logout</button>
      </div>
    </section>

    <section class="dashboard">

      <div class="header-flex">
        <h2>Manage Recipes</h2>
        <a href="create_recipe.php" class="btn-primary-sm">+ New Recipe</a>
      </div>

      <?php if(isset($_GET['msg'])): ?>
      <div class="alert-success">
        <?php echo htmlspecialchars($_GET['msg']); ?>
      </div>
      <?php endif; ?>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Image</th>
              <th>Title</th>
              <th>Author</th>
              <th>Cuisine</th>
              <th>Difficulty</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <?php if ($result->num_rows > 0): ?>
            <?php while($row = $result->fetch_assoc()): ?>
            <tr>
              <td>
                <div class="table-img">
                  <?php if($row['image_path']): ?>
                  <img src="<?php echo $row['image_path']; ?>" alt="Recipe">
                  <?php else: ?>
                  <div class="no-img">?</div>
                  <?php endif; ?>
                </div>
              </td>

              <td><strong>
                  <?php echo htmlspecialchars($row['title']); ?>
                </strong></td>

              <td>
                <?php echo htmlspecialchars($row['firstName'] . ' ' . $row['lastName']); ?>
              </td>

              <td>
                <?php echo htmlspecialchars($row['cuisine']); ?>
              </td>

              <td>
                <?php 
                      $diff = $row['difficulty']; 
                      $badgeClass = '';
                      if($diff == 'Easy') $badgeClass = 'badge-success';
                      elseif($diff == 'Medium') $badgeClass = 'badge-warning';
                      else $badgeClass = 'badge-danger';
                    ?>
                <span class="badge <?php echo $badgeClass; ?>">
                  <?php echo $diff; ?>
                </span>
              </td>

              <td class="text-muted">
                <?php echo date('M d, Y', strtotime($row['created_at'])); ?>
              </td>

              <td>
                <div class="action-btns">
                  <a href="edit_recipe.php?id=<?php echo $row['recipe_id']; ?>" class="btn-icon edit" title="Edit">
                    <i class="bi bi-pencil-square"></i>
                  </a>
                  <a href="delete_recipe_logic.php?id=<?php echo $row['recipe_id']; ?>" class="btn-icon delete"
                    onclick="return confirm('Are you sure you want to delete this recipe?');" title="Delete">
                    <i class="bi bi-trash"></i>
                  </a>
                </div>
              </td>
            </tr>
            <?php endwhile; ?>
            <?php else: ?>
            <tr>
              <td colspan="7" style="text-align:center; padding:20px;">No recipes found.</td>
            </tr>
            <?php endif; ?>
          </tbody>
        </table>
      </div>

    </section>
  </main>
</body>

</html>